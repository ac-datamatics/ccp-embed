<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<script type="text/javascript"
		src="https://unpkg.com/amazon-connect-streams@2.1.1/release/connect-streams-min.js"></script>
</head>
<!-- Add the call to init() as an onload so it will only run once the page is loaded -->

<body>
	<h1>Testing</h1>
	<div id="ccp" style="width: 400px; height: 400px;"></div>

	<div id="incoming-call-controls" style="display: none;">
		<button id="incoming-call-accept">Accept</button>
		<button id="incoming-call-reject">Reject</button>
	</div>

	<script src="./aws-connect-listener.js"></script>
	<script type="text/javascript">
		// initialize the streams api
		const connectListener = new ConnectListener(document.getElementById("ccp"), "https://ac-datamatics.my.connect.aws/ccp-v2");
		// Controls
		document.querySelector('#incoming-call-accept').onclick = connectListener.acceptIncomingCall();
		document.querySelector('#incoming-call-reject').onclick = connectListener.rejectIncomingCall();

		connectListener.onCallConnectingOrIncoming = (contact) => {
			showIncomingCallControls();
		}
		connectListener.onCallMissed = () => {
			hideIncomingCallControls();
		}
		connectListener.onCallConnected = (contact) => {
			hideIncomingCallControls();
			showCCP();
			const connection = contact.getAgentConnection();
			alert("COnnected. ID of connection is " + connection.getConnectionId());
		}
		connectListener.onCallError = () => {
			alert("error");
			hideIncomingCallControls();
			hideCCP();
		}

		connectListener.onCallPending = () => {
			alert("Pending")
		}
		
		connectListener.onCallEnded = () => {
			alert("Ended")
			hideCCP();
		}
		connectListener.onCallDestroy = () => {
			alert("Call is destroyed");
			hideCCP();
		}
		connectListener.onCallACW = () => {
			alert("ACW");
			showCCP();
		}
	</script>
</body>

</html>