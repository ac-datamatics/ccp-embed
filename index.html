<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <script type="text/javascript"
        src="https://unpkg.com/amazon-connect-streams@2.1.1/release/connect-streams-min.js"></script>
    <style>
        #ccp {
            height: 400px;
            width: 400px;
            padding: 16px;
            background: whitesmoke;
        }
    </style>
</head>
<!-- Add the call to init() as an onload so it will only run once the page is loaded -->

<body>
    <h1>Testing</h1>
    <h2>+52 55 4440 5475</h2>

    <div id="ccp">
        <div id="message">
            <p>You are not Logged in!</p>
            <button onclick="connectListener.login()">Login here!</button>
        </div>
    </div>



    <script src="./aws-connect-listener.js"></script>
    <script src="./compatibility.js"></script>
    <script type="text/javascript">

        // NO USAR 
        // Function that remove from localstorage the item that says the popup was shown, every 5 seconds
        // var intervalId = window.setInterval(function () {
        //     localStorage.removeItem('connectPopupManager::connect::loginPopup')
        // }, 5000);

        let connectListener;
        if (!isBrowserCompatible()) {
            document.querySelector("#message").innerHTML = "Sorry, browser not supported. Please switch to one of the three latest versions of Chrome or Firefox."
        } else {
            // initialize the streams api
            connectListener = new ConnectListener(document.getElementById("ccp"), "https://ac-datamatics.my.connect.aws/ccp-v2#");

            // iff the instace is initialized, then the iframe must be hidden
            if (!connectListener.initialized()) {
                document.getElementsByTagName("iframe")[0].toggleAttribute("hidden");
            }

            connectListener.onInstanceInitialized = () => {
                document.querySelector('#message').style.display = 'none';
                // once the user is logged in, the iframe must be shown
                document.getElementsByTagName("iframe")[0].removeAttribute("hidden");
            }

            connectListener.onInstanceTerminated = () => {
                document.querySelector('#message').style.display = 'initial';
                document.getElementsByTagName("iframe")[0].toggleAttribute("hidden");
            }

            connectListener.onCallConnectingOrIncoming = (contact) => {
                alert("You have an incoming call ☎️");
            }
            connectListener.onCallMissed = () => {
                alert("Missed call 📞")
            }
            connectListener.onCallConnected = (contact) => {
                const contactId = contact.getContactId();
                alert("Connected to call. ID of connection is " + contactId);
            }
            connectListener.onCallError = () => {
                alert("error");
            }

            connectListener.onCallPending = () => {
                alert("Pending")
            }

            connectListener.onCallEnded = () => {
                alert("Ended")
            }
            connectListener.onCallDestroy = () => {
                alert("Call is destroyed");
            }
            connectListener.onCallACW = () => {
                alert("ACW");
            }
        }
    </script>
</body>

</html>